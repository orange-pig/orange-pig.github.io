<!doctype html><html lang=zh-CN x-data :class=$store.darkMode.class() :data-theme=$store.darkMode.theme()><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>åŸºäºAxumçš„RustæœåŠ¡å™¨â€”â€”ä»0å¼€å§‹å·¥ç¨‹åŒ–é¡¹ç›®æ­å»º | è‹¥çƒŸé˜</title><link rel=canonical href=https://orange-pig.github.io/blog/posts/coding/%E5%9F%BA%E4%BA%8Eaxum%E7%9A%84rust%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%B7%A5%E7%A8%8B%E5%8C%96%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/><meta name=author content="é±¼äººå°é‡"><meta name=description content="éšç€è¿™å‡ å¹´Rustç¤¾åŒºServeré¢†åŸŸçš„ç”Ÿæ€å‘å±•ï¼Œ2024å¹´æˆ‘è§‰å¾—æ˜¯å°†Ruståº”ç”¨åœ¨WebæœåŠ¡å™¨ä¸€ä¸ªæ¯”è¾ƒæˆç†Ÿçš„æ—¶æœºã€‚æœ¬æ–‡å°±æ˜¯åŸºäºè¿™ä¸ªå¥‘æœºè®°å½•ä¸‹å­¦ä¹ AxumæœåŠ¡å™¨æ¡†æ¶æ­å»ºçš„ç»éªŒã€‚
"><meta name=keywords content="Rust,Axum,Tower"><meta name=generator content="Hugo 0.151.0"><meta property="og:url" content="https://orange-pig.github.io/blog/posts/coding/%E5%9F%BA%E4%BA%8Eaxum%E7%9A%84rust%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%B7%A5%E7%A8%8B%E5%8C%96%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/"><meta property="og:site_name" content="è‹¥çƒŸé˜"><meta property="og:title" content="åŸºäºAxumçš„RustæœåŠ¡å™¨â€”â€”ä»0å¼€å§‹å·¥ç¨‹åŒ–é¡¹ç›®æ­å»º"><meta property="og:description" content="éšç€è¿™å‡ å¹´Rustç¤¾åŒºServeré¢†åŸŸçš„ç”Ÿæ€å‘å±•ï¼Œ2024å¹´æˆ‘è§‰å¾—æ˜¯å°†Ruståº”ç”¨åœ¨WebæœåŠ¡å™¨ä¸€ä¸ªæ¯”è¾ƒæˆç†Ÿçš„æ—¶æœºã€‚æœ¬æ–‡å°±æ˜¯åŸºäºè¿™ä¸ªå¥‘æœºè®°å½•ä¸‹å­¦ä¹ AxumæœåŠ¡å™¨æ¡†æ¶æ­å»ºçš„ç»éªŒã€‚"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-10-15T14:15:43+08:00"><meta property="article:modified_time" content="2025-10-15T14:15:43+08:00"><meta property="article:tag" content="Rust"><meta property="article:tag" content="Axum"><meta property="article:tag" content="Tower"><meta property="og:image" content="https://orange-pig.github.io/blog/posts/coding/%E5%9F%BA%E4%BA%8Eaxum%E7%9A%84rust%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%B7%A5%E7%A8%8B%E5%8C%96%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/cover.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://orange-pig.github.io/blog/posts/coding/%E5%9F%BA%E4%BA%8Eaxum%E7%9A%84rust%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%B7%A5%E7%A8%8B%E5%8C%96%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/cover.webp"><meta name=twitter:title content="åŸºäºAxumçš„RustæœåŠ¡å™¨â€”â€”ä»0å¼€å§‹å·¥ç¨‹åŒ–é¡¹ç›®æ­å»º"><meta name=twitter:description content="éšç€è¿™å‡ å¹´Rustç¤¾åŒºServeré¢†åŸŸçš„ç”Ÿæ€å‘å±•ï¼Œ2024å¹´æˆ‘è§‰å¾—æ˜¯å°†Ruståº”ç”¨åœ¨WebæœåŠ¡å™¨ä¸€ä¸ªæ¯”è¾ƒæˆç†Ÿçš„æ—¶æœºã€‚æœ¬æ–‡å°±æ˜¯åŸºäºè¿™ä¸ªå¥‘æœºè®°å½•ä¸‹å­¦ä¹ AxumæœåŠ¡å™¨æ¡†æ¶æ­å»ºçš„ç»éªŒã€‚"><link rel=stylesheet href=/blog/css/output.min.css><style>pre{padding:1em;overflow:auto}</style><script defer src=https://cdn.jsdelivr.net/npm/alpinejs@3/dist/cdn.min.js integrity="sha256-4EHxtjnR5rL8JzbY12OKQJr81ESm7JBEb49ORPo29AY=" crossorigin=anonymous></script></head><body x-data="{
    flip: false,
  }"><div id=dream-global-bg></div><nav class="mt-4 lg:mt-8 py-4"><div class="container flex justify-between px-4"><section class="flex items-center gap-4"><div class="avatar cursor-pointer hover:avatar-online" @click="flip = !flip" title=ç¿»è½¬ä¸€ä¸‹ï¼><div class="h-10 rounded-full"><img src=/blog/img/avatar.jpg alt=è‹¥çƒŸé˜></div></div><div><a href=https://orange-pig.github.io/blog/ class="text-lg font-semibold cursor-pointer">è‹¥çƒŸé˜</a><div class="text-base-content/60 text-sm">çŸ¥è¯†æµ©ç€šè‹¥çƒŸï¼Œæˆ–æœ‰ä¸€ç“¢ã€‚ä¸æ¬²å……æ•°æ³›æ»¥ï¼Œå‡ç»ƒçœŸçŸ¥ç¼è§</div></div></section><div class="dropdown dropdown-end sm:hidden"><div tabindex=0 role=button class="btn btn-ghost btn-square" aria-label="Select an option"><ion-icon name=menu class=text-2xl></ion-icon></div><ul tabindex=0 class="dropdown-content menu w-36 bg-base-100 rounded-box z-1 shadow-md"><li><div role=link tabindex=0 class="inline-flex items-center p-2 cursor-pointer" @click="flip = !flip" title=å…³äº><ion-icon name=information-circle></ion-icon>å…³äº</div></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/blog/posts title=å½’æ¡£><ion-icon name=archive></ion-icon>å½’æ¡£</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/blog/categories title=æ‰€æœ‰åˆ†ç±»><ion-icon name=grid></ion-icon>æ‰€æœ‰åˆ†ç±»</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/blog/tags title=æ‰€æœ‰æ ‡ç­¾><ion-icon name=pricetags></ion-icon>æ‰€æœ‰æ ‡ç­¾</a></li></ul></div><section class="hidden sm:flex sm:items-center sm:gap-2 md:gap-4"><div role=link tabindex=0 class="text-sm font-semibold cursor-pointer hover:underline" @click="flip = !flip" title=å…³äº>å…³äº</div><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=/blog/posts title=å½’æ¡£><ion-icon class=group-hover:text-primary-content name=archive></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=/blog/categories title=æ‰€æœ‰åˆ†ç±»><ion-icon class=group-hover:text-primary-content name=grid></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=/blog/tags title=æ‰€æœ‰æ ‡ç­¾><ion-icon class=group-hover:text-primary-content name=pricetags></ion-icon></a></section></div></nav><div class=flip-container :class="{ 'flip-it': flip }"><div class=flipper><div class=front><div class=container><div class="lg:grid lg:grid-cols-4 gap-4 mt-4 px-4"><div class="hidden lg:block"></div><div class=lg:col-span-2><article class="mx-auto prose prose-quoteless dark:prose-invert" id=dream-single-post-main itemscope itemtype=http://schema.org/Article><meta itemprop=name content="åŸºäºAxumçš„RustæœåŠ¡å™¨â€”â€”ä»0å¼€å§‹å·¥ç¨‹åŒ–é¡¹ç›®æ­å»º"><meta itemprop=description content="éšç€è¿™å‡ å¹´Rustç¤¾åŒºServeré¢†åŸŸçš„ç”Ÿæ€å‘å±•ï¼Œ2024å¹´æˆ‘è§‰å¾—æ˜¯å°†Ruståº”ç”¨åœ¨WebæœåŠ¡å™¨ä¸€ä¸ªæ¯”è¾ƒæˆç†Ÿçš„æ—¶æœºã€‚æœ¬æ–‡å°±æ˜¯åŸºäºè¿™ä¸ªå¥‘æœºè®°å½•ä¸‹å­¦ä¹ AxumæœåŠ¡å™¨æ¡†æ¶æ­å»ºçš„ç»éªŒã€‚"><meta itemprop=datePublished content="2025-10-15T14:15:43+08:00"><meta itemprop=dateModified content="2025-10-15T14:15:43+08:00"><meta itemprop=wordCount content="925"><meta itemprop=image content="https://orange-pig.github.io/blog/posts/coding/%E5%9F%BA%E4%BA%8Eaxum%E7%9A%84rust%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%B7%A5%E7%A8%8B%E5%8C%96%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/cover.webp"><meta itemprop=keywords content="Rust,Axum,Tower"><header><h1 itemprop=headline>åŸºäºAxumçš„RustæœåŠ¡å™¨â€”â€”ä»0å¼€å§‹å·¥ç¨‹åŒ–é¡¹ç›®æ­å»º</h1><p class=text-sm>æ˜ŸæœŸä¸‰, 10æœˆ 15, 2025
| <span>5åˆ†é’Ÿé˜…è¯»</span>
| <span>æ›´æ–°äº
æ˜ŸæœŸä¸‰, 10æœˆ 15, 2025</span></p><div class="flex justify-between"><div class="flex items-center"><span>@</span>
<span itemprop=author itemscope itemtype=https://schema.org/Person><span itemprop=name>é±¼äººå°é‡</span></span></div><div class="flex items-center gap-2"><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://x.com/intent/post?text=%e5%9f%ba%e4%ba%8eAxum%e7%9a%84Rust%e6%9c%8d%e5%8a%a1%e5%99%a8%e2%80%94%e2%80%94%e4%bb%8e0%e5%bc%80%e5%a7%8b%e5%b7%a5%e7%a8%8b%e5%8c%96%e9%a1%b9%e7%9b%ae%e6%90%ad%e5%bb%ba&amp;url=https://orange-pig.github.io/blog/posts/coding/%E5%9F%BA%E4%BA%8Eaxum%E7%9A%84rust%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%B7%A5%E7%A8%8B%E5%8C%96%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/" target=_blank rel="noopener noreferrer" title="Share on X"><ion-icon class=group-hover:text-primary-content name=logo-x></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://facebook.com/sharer/sharer.php?u=https://orange-pig.github.io/blog/posts/coding/%E5%9F%BA%E4%BA%8Eaxum%E7%9A%84rust%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%B7%A5%E7%A8%8B%E5%8C%96%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/" target=_blank rel="noopener noreferrer" title="Share on Facebook"><ion-icon class=group-hover:text-primary-content name=logo-facebook></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://wa.me/?text=%e5%9f%ba%e4%ba%8eAxum%e7%9a%84Rust%e6%9c%8d%e5%8a%a1%e5%99%a8%e2%80%94%e2%80%94%e4%bb%8e0%e5%bc%80%e5%a7%8b%e5%b7%a5%e7%a8%8b%e5%8c%96%e9%a1%b9%e7%9b%ae%e6%90%ad%e5%bb%ba%20https://orange-pig.github.io/blog/posts/coding/%E5%9F%BA%E4%BA%8Eaxum%E7%9A%84rust%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%B7%A5%E7%A8%8B%E5%8C%96%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/" target=_blank rel="noopener noreferrer" title="Share on WhatsApp"><ion-icon class=group-hover:text-primary-content name=logo-whatsapp></ion-icon></a></div></div></header><section id=dream-single-post-content itemprop=articleBody><p>éšç€è¿™å‡ å¹´Rustç¤¾åŒºServeré¢†åŸŸçš„ç”Ÿæ€å‘å±•ï¼Œ2024å¹´æˆ‘è§‰å¾—æ˜¯å°†Ruståº”ç”¨åœ¨WebæœåŠ¡å™¨ä¸€ä¸ªæ¯”è¾ƒæˆç†Ÿçš„æ—¶æœºã€‚æœ¬æ–‡å°±æ˜¯åŸºäºè¿™ä¸ªå¥‘æœºè®°å½•ä¸‹å­¦ä¹ AxumæœåŠ¡å™¨æ¡†æ¶æ­å»ºçš„ç»éªŒã€‚</p><p>åç«¯è¯­è¨€çš„é€‰æ‹©ä¸Šï¼Œä¸€èˆ¬ä¸æƒ³æPythonã€Javaæˆ–è€…JSç¯å¢ƒçš„éƒ½ä¼šé€‰æ‹©Goã€‚åœ¨æœåŠ¡å™¨é¢†åŸŸRustæ‹¥æœ‰å¾ˆå¤šGoçš„ä¼˜ç‚¹ï¼š</p><ul><li>å•æ–‡ä»¶æ— ä¾èµ–</li><li>äºŒè¿›åˆ¶æ–‡ä»¶ä½“ç§¯å°</li><li>éƒ¨ç½²ç®€å•</li><li>å¯é æ•ˆç‡é«˜</li></ul><p>è¿˜æœ‰å¾ˆå¤šå…¶ä»–è¯­è¨€éƒ½ä¸å…·å¤‡çš„å¸å¼•äººçš„ç‰¹æ€§ï¼š</p><ul><li>æ‹¥æœ‰æœ€å¥½ç”¨çš„åŒ…ç®¡ç†å’Œå¼€å‘å·¥å…·â€”â€” Cargo</li><li>è‡´åŠ›äºæä¾›æä½³å¼€å‘ä½“éªŒçš„ç¤¾åŒºâ€”â€”å¸¦æ¥çš„è½»æ¾èˆ’é€‚çš„å­¦ä¹ ä½“éªŒ</li><li>å¤§é‡å°å·§è€Œå¼ºå¤§çš„ Cratesï¼ˆruståŒ…ï¼‰â€”â€”åšå®çš„ä¾é </li></ul><p>è®©æˆ‘ä»¬å¼€å§‹å§ï¼</p><blockquote><p>ç›®å‰æ–‡ç« è¿˜æœªå®Œæˆè§„åˆ’å†…å®¹ï¼Œåç»­æŒç»­è¡¥å……</p></blockquote><h2 id=å‡†å¤‡>å‡†å¤‡</h2><p>å­¦ä¹ ä»»ä½•ä¸€ä¸ªæ–°ä¸œè¥¿éƒ½è¦è®°å¾—ï¼Œä¸è¦ç»™è‡ªå·±å¢åŠ åŒ…è¢±å’Œé™åˆ¶ã€‚</p><p><strong>Keep Simple! ä¸æŠŠäº‹æƒ…å¤æ‚åŒ–ï¼Œé€‰æ‹©æœ€ç®€å•çš„ã€‚</strong></p><p>å…¶å®ï¼Œæ¡æ¡å¤§è·¯é€šç½—é©¬ã€‚ä¸€ä¸ªæœ€ä½³çš„å®è·µå°±æ˜¯è·Ÿç€ç¤¾åŒºç»è¿‡æ—¶é—´é€‰æ‹©å‡ºçš„èµ„æºï¼Œé€‰ä¸€ä¸ªç¬¦åˆä½ å­¦ä¹ ä¹ æƒ¯çš„è·Ÿéšå­¦ä¹ ï¼Œè¿‡ç¨‹ä¸­å¤šå‚è€ƒå…¶ä»–èµ„æ–™å¤šæé—®ã€‚</p><h3 id=1-å®‰è£…rustç¯å¢ƒ>1. å®‰è£…Rustç¯å¢ƒ</h3><p>æ— éœ€åˆ›é€ æ›´å¤šçš„æ•™ç¨‹ï¼Œè·Ÿç€å®˜æ–¹çš„å¼•å¯¼å®‰è£…å¥½rustã€‚<a href=https://www.rust-lang.org/zh-CN/learn/get-started target=_blank>å…¥é—¨ - Rust ç¨‹åºè®¾è®¡è¯­è¨€ (rust-lang.org)</a></p><h3 id=2-é…ç½®ç¼–è¾‘å™¨vscode>2. é…ç½®ç¼–è¾‘å™¨VSCode</h3><p>Rustçš„å¼€å‘ä½“éªŒæ€»ä½“ä¸Šæ˜¯ä¸€ç§è½»å·§çš„æ„Ÿè§‰ï¼Œæœ‰å¾ˆå¤šç¼–è¾‘å™¨å¯ä»¥é€‰æ‹©ï¼Œè¿™é‡Œä»¥VSCodeä¸ºä¾‹ã€‚</p><p>åœ¨æ’ä»¶å•†åº—æœç´¢å¹¶å®‰è£…ä¸‹é¢å‡ ä¸ªæ‰©å±•ï¼š</p><p><strong>rust-analyzer</strong></p><p>rustæ’ä»¶å·²ç»è¢«åºŸå¼ƒï¼Œè€Œå®˜æ–¹æ‹›å®‰äº† rust-analyzer æ’ä»¶å¹¶æŠŠå®ƒæ‰¶æ­£äº†ã€‚æ’ä»¶æœ¬èº«æä¾›ä»£ç è¡¥å…¨ã€å®šä¹‰è·³è½¬ã€å¼•ç”¨æŸ¥æ‰¾ã€ç±»å‹æ–‡æ¡£æç¤ºã€è¯­æ³•æ£€æŸ¥ã€ä»£ç æ ¼å¼åŒ–ã€é”™è¯¯æç¤ºå’Œå»ºè®®ç­‰ç­‰åŠŸèƒ½ï¼Œå¼€ç®±å³ç”¨ï¼Œåªéœ€è¦ä¸€ä¸ªå°±è¡Œï¼Œä¸ªäººæ„Ÿè§‰æ¯”Goçš„æ’ä»¶å¥½ç”¨ã€‚</p><p><strong>REST Client ï¼ˆéå¿…é¡»ï¼‰</strong></p><p>åšwebå¼€å‘çš„å°ä¼™ä¼´éƒ½å¯ä»¥ç”¨åˆ°çš„restå®¢æˆ·ç«¯ã€‚ä»–é€šè¿‡åœ¨æ–‡ä»¶ä¸­ç¼–è¾‘restè¯·æ±‚ï¼Œç‚¹å‡»å‘é€å¹¶æŸ¥çœ‹ç»“æœã€‚è™½ç„¶ï¼Œæ²¡æœ‰Postmançš„åŠŸèƒ½å¼ºå¤§ï¼Œä½†æ˜¯ç®€å•æ˜“ç”¨è¦†ç›–å¤§éƒ¨åˆ†åœºæ™¯ã€‚</p><p><strong>Database Clientï¼ˆéå¿…é¡»ï¼‰</strong></p><p>å¦‚æœä½ æ²¡æœ‰è´­ä¹°å®‰è£… Navicatï¼Œé‚£ä¹ˆè¿™ä¸ªæ’ä»¶å°†ä¼šæ˜¯ä¸€ä¸ªvscodeä¸€ç«™å¼ä¸ç”¨æ¢ä¹˜çš„æ•°æ®åº“å®¢æˆ·ç«¯å¥½å·¥å…·ã€‚å®‰è£…ååœ¨ä¾§è¾¹æ å¯ç›´æ¥åˆ›å»ºæ•°æ®åº“è¿æ¥ï¼Œå¤šä¸ªè¿æ¥ä»¥æ–‡ä»¶ç›®å½•çš„å½¢å¼åˆ†ç±»ã€‚å¯ä»¥å¯¹æ•°æ®åº“è¿›è¡Œæ–°å»ºã€æŸ¥è¯¢ã€æ’å…¥ç­‰ä¸€ç³»åˆ—åŸºæ“ï¼Œè¦†ç›–å¸¸è§„çš„ä½¿ç”¨åœºæ™¯ã€‚</p><h3 id=3-æœåŠ¡ç«¯æŠ€æœ¯é€‰å‹åˆ†æ>3. æœåŠ¡ç«¯æŠ€æœ¯é€‰å‹åˆ†æ</h3><p><code>æœåŠ¡ç«¯æ¡†æ¶</code></p><p>é€‰æ‹© axumï¼Œaxum æ˜¯ç°åœ¨æœ€ç«çƒ­çš„æœåŠ¡å™¨æ¡†æ¶ã€‚å¾ˆå¤šäººé€‰å®ƒçš„ç†ç”±ä¹Ÿåº”è¯¥æ˜¯ä»–å°å·§è€Œæ‹“å±•æ€§å¼ºï¼ŒåŸºäº tokioã€tower å’Œ hyper å¸¦æ¥äº†å¼ºå¤§å®Œæ•´çš„ç”Ÿæ€ï¼Œæ›´æ˜¯å› ä¸ºå®ƒä¸“æ³¨äºäººä½“å·¥ç¨‹å­¦å¸¦æ¥çš„èˆ’é€‚çš„å¼€å‘ä½“éªŒã€‚</p><p><code>æ•°æ®åº“è¿æ¥</code></p><p>é€‰æ‹©sqlxï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªORMåº“ã€‚è™½ç„¶ORMåº“å·²ç»åœ¨å…¶ä»–æˆç†Ÿåç«¯æ¡†æ¶ä¸­éªŒè¯æœ‰ä»·å€¼ï¼Œä½†æ˜¯å¥½åƒä¸rustçš„è¯­è¨€è°ƒæ€§ä¸æ˜¯å¾ˆæ­ï¼Œç›®å‰çš„ORMåº“æˆ‘è§‰å¾—éƒ½è¾¾ä¸åˆ°å·¥ç¨‹åŒ–å’Œäººä½“å·¥ç¨‹å­¦çš„è¦æ±‚ã€‚sqlx çš„ api ä½¿ç”¨ç®€å•ï¼Œæ•ˆç‡é«˜ï¼Œç»“åˆsqlbuilder æˆ‘è§‰å¾—åœ¨ä¸­å°å‹çš„é¡¹ç›®ä¸­æˆ‘è§‰å¾—æ¸¸åˆƒæœ‰ä½™ã€‚</p><p>æ‹“å±•ï¼šåœ¨ä¸€ä¸ªrust æœåŠ¡å™¨æ„å»ºæ¨¡æ¿ rust on nailsä¸­ä½¿ç”¨äº† cornucopia è¿™ä¸ªåº“ï¼Œé€šè¿‡sqlåå‘ç”Ÿæˆä»£ç ï¼Œçœ‹èµ·æ¥å¾ˆä¸é”™çš„ä¸€ä¸ªå°è¯•ã€‚</p><h2 id=å¼€å§‹æ­å»º>å¼€å§‹æ­å»º</h2><p><strong>æ³¨æ„</strong>ï¼šæ–‡ç« å†…å®¹éƒ½å¯ä»¥åœ¨æ¨¡æ¿é¡¹ç›® <a href=https://github.com/orange-pig/rust_project_templates target=_blank>rust_project_templates (github)</a>
å†…çš„ <strong>rust-on-bubbles</strong> ä¸­æ‰¾åˆ°å®Œæ•´ä»£ç ã€‚</p><blockquote><p><strong>Rust on Bubbles</strong> æ„ä¸ºæ°”æ³¡ä¸Šæ–‘æ–“å¤šå½©çš„é”ˆè¿¹ï¼Œè¡¨ç¤ºrustç»™æˆ‘ä»¬å¸¦æ¥çš„ä¸°å¯Œçš„å¯èƒ½æ€§ã€‚</p></blockquote><h3 id=1-åˆ›å»ºé¡¹ç›®>1. åˆ›å»ºé¡¹ç›®</h3><p>æ‰§è¡Œå‘½ä»¤:</p><blockquote><p>cargo new your-project-name</p></blockquote><p>éªŒè¯ä¸€ä¸‹ï¼Œé»˜è®¤é¡¹ç›®ä¼šæ‰“å° Hello, world!ï¼š</p><blockquote><p>cd your-project-name</p></blockquote><blockquote><p>cargo run</p></blockquote><p><code>æ‹“å±•ä¸€ä¸‹</code></p><p>æƒ…å†µä¸€ï¼šåˆ›å»ºä¸€ä¸ªæ²¡æœ‰ git æœ¬åœ°çš„æ–°é¡¹ç›® local-project</p><blockquote><p>cargo new local-project &ndash;vcs none</p></blockquote><p>æƒ…å†µäºŒï¼šåˆå§‹åŒ–ä¸€ä¸ªåˆš Clone ä¸‹æ¥çš„ç©ºä»“åº“</p><blockquote><p># cd to your project</p><p>cargo init</p></blockquote><h3 id=2-æ„å»ºç›®å½•ç»“æ„>2. æ„å»ºç›®å½•ç»“æ„</h3><p>ç¤¾åŒºé‡Œçš„ç¤ºä¾‹é¡¹ç›®åŸºæœ¬éƒ½æ˜¯ä¸€ä¸ªå•é¡¹ç›®ï¼Œä½†æ˜¯å¯¹äºå·¥ç¨‹å®é™…çš„æœåŠ¡ç«¯æ¥è¯´ï¼Œä¸€ä¸ªå•é¡¹ç›®ä¼šè®©äº‹æƒ…å˜å¾—æ›´åŠ å¤æ‚ã€‚åŒæ—¶ï¼Œé¿å…æå‡ºæ›´å¤æ‚çš„ä¸‰å±‚æ¶æ„ï¼Œæˆ‘ä»¬å°†æŒ‰ç…§æœåŠ¡å¯¹è±¡çš„ä¸åŒï¼Œå°†ä»£ç ç®€å•åˆ†æˆä¸¤ä¸ªä»“åº“ï¼š</p><ul><li>é¢å‘æ•°æ®åº“äº¤äº’çš„ <strong>db</strong></li><li>é¢å‘ä¸šåŠ¡äº¤äº’çš„ <strong>server</strong></li></ul><p>è¿™é‡Œè¦ç”¨åˆ° cargo é¡¹ç›®ç®¡ç†çš„ workspace åŠŸèƒ½ã€‚</p><p>é¦–å…ˆï¼Œåœ¨é¡¹ç›®æ ¹æ®ç›®å½•åˆ›å»º<code>crates</code>ç›®å½•ç”¨æ¥æ”¾ç½®å¤šä¸ªé¡¹ç›®ã€‚</p><p>å…¶æ¬¡ï¼Œåœ¨å…¶ä¸­åˆ›å»ºäºŒè¿›åˆ¶é¡¹ç›®<code>server</code>å’Œåº“é¡¹ç›®<code>db</code>ã€‚</p><blockquote><p>cargo new crates/server</p><p>cargo new crates/db &ndash;lib</p></blockquote><p>ğŸ”” æé†’ï¼šé¡¹ç›®ä¸ä¸€å®šéè¦æ”¾åˆ° crates ç›®å½•é‡Œï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ”¾æ ¹ç›®å½•ä¸‹ï¼Œåªæ˜¯è¿™ä¹ˆåšäº•ç„¶æœ‰åºä¸€äº›ï¼Œä½ æ ¹æ®è‡ªå·±å–œå¥½ç»„ç»‡ã€‚</p><p>æœ€åï¼Œåˆ é™¤æ ¹ç›®å½•ä¸‹çš„<code>src</code>ç›®å½•ï¼Œå¹¶ä¿®æ”¹æ ¹ç›®å½•ä¸‹çš„<code>Cargo.toml</code>ä¸ºï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Cargo.toml data-lang=Cargo.toml><span style=display:flex><span>[<span style=color:#a6e22e>workspace</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>members</span> = [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;crates/*&#34;</span>,
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>resolver</span> = <span style=color:#e6db74>&#34;2&#34;</span>
</span></span></code></pre></div><p>è¿è¡Œ<code>cargo run</code>éªŒè¯ä¸€ä¸‹ï¼Œè¾“å‡º Hello, world!</p><p>ğŸ‘€ æ‹“å±•ï¼šéœ€è¦äº†è§£ Cargo.toml æ›´å¤šçš„é…ç½®ï¼Œå¯æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ <a href=https://rustwiki.org/zh-CN/cargo/reference/manifest.html target=_blank>æ¸…å•æ ¼å¼ - Cargo æ‰‹å†Œ ä¸­æ–‡ç‰ˆ (rustwiki.org)</a></p><h3 id=3-åˆå§‹åŒ–-server-é¡¹ç›®>3. åˆå§‹åŒ– server é¡¹ç›®</h3><p>ä¾æ¬¡æ‰§è¡Œä¸‹é¢æ·»åŠ ä¾èµ–åŒ…ï¼š</p><blockquote><p>cd crates/server</p><p>cargo add axum</p><p>cargo add axum-macros</p><p>cargo add serde -F derive</p><p>cargo add tokio -F full</p><p>cargo build</p></blockquote><p>ğŸ’¡ æç¤ºï¼šæ·»åŠ äº†ä¾èµ–åº“åè¿è¡Œä¸€ä¸‹buildæ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ï¼Œå¯ä»¥è®©åé¢ç¼–å†™ä»£ç æ—¶ä»£ç æç¤ºå¤„äºå·²å‡†å¤‡å¥½çš„çŠ¶æ€ï¼Œé¿å…å› ä¸ºä¾èµ–æ‰¾ä¸åˆ°å¯¼è‡´ä»£ç æŠ¥é”™ï¼Œåˆ¶é€ å‡ºå¤§é‡çš„panicã€‚</p><p>è¿™äº›åŒ…åªæ˜¯ç›®å‰ä¼šç”¨åˆ°çš„ï¼Œåœ¨å¼€å‘ä¸­éœ€è¦ç”¨ä»€ä¹ˆåŒ…å†æ·»åŠ ä»€ä¹ˆåŒ…ï¼Œfeature(å¯é€‰åŠŸèƒ½) ä¹Ÿæ˜¯éœ€è¦ç”¨åˆ°äº†å†å» Cargo.toml ä¸­æ‰‹åŠ¨æ·»åŠ ï¼Œåšåˆ° <em><strong>å¦‚æ— å¿…è¦å‹¿å¢å®ä½“</strong></em> å³å¯ã€‚å®‰è£…å<code>Cargo.toml</code>æ˜¯è¿™æ ·ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-server/Cargo.toml data-lang=server/Cargo.toml><span style=display:flex><span>[<span style=color:#a6e22e>package</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;server&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>version</span> = <span style=color:#e6db74>&#34;0.1.0&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>edition</span> = <span style=color:#e6db74>&#34;2021&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>dependencies</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>axum</span> = <span style=color:#e6db74>&#34;0.7.7&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>axum-macros</span> = <span style=color:#e6db74>&#34;0.4.2&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>serde</span> = { <span style=color:#a6e22e>version</span> = <span style=color:#e6db74>&#34;1.0.210&#34;</span>, <span style=color:#a6e22e>features</span> = [<span style=color:#e6db74>&#34;derive&#34;</span>] }
</span></span><span style=display:flex><span><span style=color:#a6e22e>tokio</span> = { <span style=color:#a6e22e>version</span> = <span style=color:#e6db74>&#34;1.40.0&#34;</span>, <span style=color:#a6e22e>features</span> = [<span style=color:#e6db74>&#34;full&#34;</span>] }
</span></span></code></pre></div><p>å°†<code>main.rs</code>å†…å®¹æ›¿æ¢ä¸ºä¸‹é¢çš„ä»£ç ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-main.rs data-lang=main.rs><span style=display:flex><span><span style=color:#66d9ef>use</span> axum::{response::Html, routing::get, Router};
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> tokio::net::TcpListener;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[tokio::main]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ## build application
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> app <span style=color:#f92672>=</span> Router::new()
</span></span><span style=display:flex><span>        .route(<span style=color:#e6db74>&#34;/&#34;</span>, get(Html(<span style=color:#e6db74>&#34;&lt;h1&gt;Hello World!&lt;/h1&gt;&#34;</span>)))
</span></span><span style=display:flex><span>        .route(<span style=color:#e6db74>&#34;/hello&#34;</span>, get(<span style=color:#f92672>||</span> <span style=color:#66d9ef>async</span> { <span style=color:#e6db74>&#34;Hello Rust on Bubble!&#34;</span> }));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ## run app with hyper, listening globally on port 3000
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> listener <span style=color:#f92672>=</span> TcpListener::bind(<span style=color:#e6db74>&#34;0.0.0.0:3000&#34;</span>).<span style=color:#66d9ef>await</span>.unwrap();
</span></span><span style=display:flex><span>    axum::serve(listener, app).<span style=color:#66d9ef>await</span>.unwrap();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œ<code>cargo run</code>å¯åŠ¨æœåŠ¡å™¨ï¼Œåœ¨æµè§ˆå™¨è¾“å…¥<code>localhost:3000</code>å’Œ<code>localhost:3000/hello</code>æŸ¥çœ‹ç»“æœã€‚</p><h3 id=4-å®ç°ç”¨æˆ·api>4. å®ç°ç”¨æˆ·api</h3><p>é¦–å…ˆï¼Œéœ€è¦å…ˆå®šä¹‰ä¸šåŠ¡å¯¹è±¡ï¼Œè®©æˆ‘ä»¬åˆ›å»º<code>models</code>æ¨¡å—ã€‚</p><blockquote><p>ğŸ‚ Cargo å®šä¹‰æ¯ä¸€ä¸ªæ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæ¯ä¸€ä¸ªæ–‡ä»¶å¤¹ä¹Ÿæ˜¯ä¸€ä¸ªæ¨¡å—ã€‚æ–‡ä»¶æ¨¡å—ä¸­çš„å¯¼å‡ºæ˜¯é€šè¿‡<code>pub</code>å…³é”®å­—ï¼Œæ–‡ä»¶å¤¹éœ€è¦mod.rsæ–‡ä»¶æ¥æŒ‡å®šéœ€è¦å‘å¤–éƒ¨<code>pub</code>å“ªäº›æ–‡ä»¶æ¨¡å—ï¼Œä»è€Œå½¢æˆå‘½åç©ºé—´çš„å±‚çº§ç»“æ„ã€‚</p></blockquote><p>åœ¨<code>server/src</code>ç›®å½•ä¸‹åˆ›å»º<code>models</code>ç›®å½•ï¼Œåœ¨å…¶ä¸­åˆ›å»º<code>mod.rs</code>å’Œ<code>user.rs</code>ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-models/user.rs data-lang=models/user.rs><span style=display:flex><span><span style=color:#66d9ef>use</span> serde::{Deserialize, Serialize};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[derive(Deserialize, Serialize, Clone)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>User</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pub</span> name: String,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pub</span> email: String,
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-models/mod.rs data-lang=models/mod.rs><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>mod</span> user;
</span></span></code></pre></div><p>ç„¶åï¼Œå®šä¹‰è·¯ç”±å¤„ç†å™¨ï¼Œè®©æˆ‘ä»¬åˆ›å»º<code>handlers</code>æ¨¡å—ã€‚</p><p>åœ¨<code>server/src</code>ç›®å½•ä¸‹åˆ›å»º<code>handlers</code>ç›®å½•ï¼Œåœ¨å…¶ä¸­åˆ›å»º<code>mod.rs</code>å’Œ<code>user.rs</code>ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-handlers/user.rs data-lang=handlers/user.rs><span style=display:flex><span><span style=color:#66d9ef>use</span> axum::{
</span></span><span style=display:flex><span>    http::StatusCode,
</span></span><span style=display:flex><span>    Json,
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span>  <span style=color:#66d9ef>crate</span>::models::user::User;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[axum_macros::debug_handler]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>get_user</span>() -&gt; Result<span style=color:#f92672>&lt;</span>Json<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span>, StatusCode<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    Ok(Json(User {
</span></span><span style=display:flex><span>        name: <span style=color:#e6db74>&#34;alpha&#34;</span>.to_string(),
</span></span><span style=display:flex><span>        email: <span style=color:#e6db74>&#34;a@a.com&#34;</span>.to_string(),
</span></span><span style=display:flex><span>    }))
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-handlers/mod.rs data-lang=handlers/mod.rs><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>mod</span> user;
</span></span></code></pre></div><p>æœ€ååœ¨<code>main.rs</code>ä¸­é…ç½®è·¯ç”±ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-server/src/main.rs data-lang=server/src/main.rs><span style=display:flex><span><span style=color:#66d9ef>use</span> axum::{routing::get, Router};
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> handlers::user::get_user;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> tokio::net::TcpListener;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>mod</span> handlers;
</span></span><span style=display:flex><span><span style=color:#66d9ef>mod</span> models;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[tokio::main]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> user_router <span style=color:#f92672>=</span> Router::new().route(<span style=color:#e6db74>&#34;/&#34;</span>, get(get_user));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ## build application
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> app <span style=color:#f92672>=</span> Router::new().nest(<span style=color:#e6db74>&#34;/user&#34;</span>, user_router);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ## run app with hyper, listening globally on port 3000
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> listener <span style=color:#f92672>=</span> TcpListener::bind(<span style=color:#e6db74>&#34;0.0.0.0:3000&#34;</span>).<span style=color:#66d9ef>await</span>.unwrap();
</span></span><span style=display:flex><span>    axum::serve(listener, app).<span style=color:#66d9ef>await</span>.unwrap();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œ<code>cargo run</code>å¯åŠ¨æœåŠ¡å™¨ï¼Œåœ¨æµè§ˆå™¨è¾“å…¥<code>localhost:3000/user</code>æŸ¥çœ‹ç»“æœã€‚</p><blockquote><p>ğŸ’¨ åç»­å¯ç»§ç»­æŒ‰ç…§è¿™ä¸ªæ¨¡å¼æ·»åŠ æ›´å¤šçš„è·¯ç”±å’Œhandlerã€‚</p></blockquote><h3 id=5-åˆå§‹åŒ–-db-é¡¹ç›®>5. åˆå§‹åŒ– db é¡¹ç›®</h3><p>åˆå§‹åŒ–dbé¡¹ç›®å‰éœ€è¦å‡†å¤‡å¥½ä½ çš„æ•°æ®åº“ï¼Œsqlx æ”¯æŒ mysqlã€postgresqlã€sqlliteï¼Œä»¥ postgresql(ç®€ç§°pgsql) ä¸ºä¾‹ã€‚</p><p>åœ¨ db é¡¹ç›®ä¸­åˆ›å»º src çš„åŒçº§ç›®å½• <strong>migrations</strong>ï¼Œç”¨æ¥æ”¾ç½®åˆå§‹åŒ–æ•°æ®åº“çš„ sql æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ª db.sql æ–‡ä»¶ã€‚</p><p><img src="https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/f2f649ebd91f49ec961985134a05339b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bG85Lq65bCP6YeO:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMTQ5MTM3NTk5Nzg1NjYyMSJ9&amp;rk3s=f64ab15b&amp;x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&amp;x-orig-expires=1761113756&amp;x-orig-sign=9wFAPA9Do1LqZ%2BsBzMqH7Yhjd7I%3D" alt></p><p>å‡è®¾ä½ å·²ç»åœ¨å¼€å‘ç¯å¢ƒä¸Šå®‰è£…å¥½äº† pgsql å’Œ vscode çš„ <strong>Database Client æ’ä»¶</strong>ï¼Œé‚£ä¹ˆåªéœ€è¦åœ¨ vscode çš„ä¾§è¾¹æ ä¸Šé€‰æ‹© <strong>Database</strong> é¢æ¿ä¸­åˆ›å»ºä½ çš„ pgsql çš„è¿æ¥ã€‚</p><p>ç„¶åï¼Œåœ¨åˆ›å»ºçš„æ•°æ®åº“è¿æ¥ä¸Šç‚¹å‡» â€œ+â€ å·åˆ›å»ºæ•°æ®åº“ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/8b88da63345140f099cc7cdb635f0c22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bG85Lq65bCP6YeO:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMTQ5MTM3NTk5Nzg1NjYyMSJ9&amp;rk3s=f64ab15b&amp;x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&amp;x-orig-expires=1761113756&amp;x-orig-sign=KHZD6V6zZkcMbvJkU52XO0x8Jt8%3D" alt></p><p>å°±ä¼šåœ¨å·¦ä¾§åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„åˆå§‹åŒ– sql æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¸ä½¿ç”¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œåªæ˜¯å¤åˆ¶å…¶ç¬¬ä¸€è¡Œçš„è¿æ¥ä¿¡æ¯åˆ°å‰é¢åˆ›å»ºçš„ db.sql æ–‡ä»¶ä¸­ç¬¬ä¸€è¡Œã€‚ï¼ˆåœ¨ä¸ä½¿ç”¨ <strong>Database Client æ’ä»¶</strong> çš„æƒ…å†µä¸‹ï¼Œè¿™è¡Œè¿æ¥ä¿¡æ¯ä¸æ˜¯å¿…é¡»çš„ï¼‰</p><p>ç„¶åï¼Œåœ¨ä¸‹é¢æ·»åŠ å¦‚ä¸‹çš„ sql ä»£ç ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-migrations/db.sql data-lang=migrations/db.sql><span style=display:flex><span><span style=color:#75715e>-- Active: 6666666666666@@127.0.0.1@5432
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>DATABASE</span> your_db_name
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#a6e22e>users</span> (
</span></span><span style=display:flex><span>  id serial <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>,
</span></span><span style=display:flex><span>  name <span style=color:#66d9ef>VARCHAR</span>(<span style=color:#ae81ff>50</span>) <span style=color:#66d9ef>UNIQUE</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>  email <span style=color:#66d9ef>VARCHAR</span>(<span style=color:#ae81ff>255</span>) <span style=color:#66d9ef>UNIQUE</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;users&#34;</span> (<span style=color:#e6db74>&#34;id&#34;</span>, <span style=color:#e6db74>&#34;name&#34;</span>, <span style=color:#e6db74>&#34;email&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#39;user1&#39;</span>, <span style=color:#e6db74>&#39;user1@mail.com,&#39;</span>),
</span></span><span style=display:flex><span>    (<span style=color:#ae81ff>2</span>, <span style=color:#e6db74>&#39;user2&#39;</span>, <span style=color:#e6db74>&#39;user2@mail.com,&#39;</span>),
</span></span><span style=display:flex><span>    (<span style=color:#ae81ff>3</span>, <span style=color:#e6db74>&#39;user3&#39;</span>, <span style=color:#e6db74>&#39;user3@mail.com,&#39;</span>);
</span></span></code></pre></div><p>å¦‚æœä½ å·²ç»å®‰è£…äº† <strong>Database Client</strong> æ’ä»¶ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥ç‚¹å‡» sql è¡Œä¸Šçš„ Run ä¸€æ¬¡æ‰§è¡Œå®Œæ‰€æœ‰çš„ sqlï¼Œå®Œæˆæ•°æ®åº“åˆ›å»ºã€‚åŒæ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨å…¶ä»–ä»»ä½•ç†Ÿæ‚‰çš„æ–¹å¼æ‰§è¡Œ sqlã€‚</p><p>æ¥ç€æˆ‘ä»¬å¼€å§‹ db åº“çš„åˆå§‹åŒ–ï¼Œä¾æ¬¡æ‰§è¡Œä¸‹é¢æ·»åŠ ä¾èµ–åŒ…ï¼š</p><blockquote><p>cd crates/db</p><p>cargo add sqlx -F runtime-tokio,tls-native-tls,derive,macros,postgres</p><p>cargo add serde -F derive</p><p>cargo build</p></blockquote><p>å®‰è£…å<code>Cargo.toml</code>æ˜¯è¿™æ ·ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-db/Cargo.toml data-lang=db/Cargo.toml><span style=display:flex><span>[<span style=color:#a6e22e>package</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;db&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>version</span> = <span style=color:#e6db74>&#34;0.1.0&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>edition</span> = <span style=color:#e6db74>&#34;2021&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>dependencies</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>serde</span> = { <span style=color:#a6e22e>version</span> = <span style=color:#e6db74>&#34;1.0.210&#34;</span>, <span style=color:#a6e22e>features</span> = [<span style=color:#e6db74>&#34;derive&#34;</span>] }
</span></span><span style=display:flex><span><span style=color:#a6e22e>sqlx</span> = { <span style=color:#a6e22e>version</span> = <span style=color:#e6db74>&#34;0.8.2&#34;</span>, <span style=color:#a6e22e>features</span> = [<span style=color:#e6db74>&#34;runtime-tokio&#34;</span>, <span style=color:#e6db74>&#34;tls-native-tls&#34;</span>, <span style=color:#e6db74>&#34;derive&#34;</span>, <span style=color:#e6db74>&#34;macros&#34;</span>, <span style=color:#e6db74>&#34;postgres&#34;</span>] }
</span></span></code></pre></div><blockquote><p>âš ï¸ <strong>ä¸¥é‡æ³¨æ„</strong>ï¼šç”±äº <strong>ring</strong> è¿™ä¸ªåº“ä¼šå¯¼è‡´ä»»ä½•æ›´æ”¹éƒ½ä¼šè§¦å‘é¡¹ç›®çš„é‡æ–°ç¼–è¯‘ï¼Œè€Œ sqlx çš„ features é€‰æ‹© result-tls ç­‰ä¾èµ–äº <strong>ring</strong> åº“çš„åŠŸèƒ½æ—¶ï¼Œå°±ä¼šå¯¼è‡´ wactch æ•´ä¸ªé¡¹ç›®å¹¶ä¸ä¼šè¿›è¡Œå¢é‡ç¼–è¯‘è¿…é€Ÿé‡å¯ï¼Œè€Œæ˜¯è¦ç­‰å¾…å…¨éƒ¨é‡æ–°ç¼–è¯‘ã€‚ç”±äºéå¸¸çš„è€—æ—¶ï¼Œå®ƒä¼šè®©ä½ æƒ³è¦ä¿®æ”¹ä»£ç åé©¬ä¸Šè¿è¡Œèµ·æœåŠ¡è¿›è¡Œè°ƒè¯•æˆä¸ºä¸å¯èƒ½ã€‚</p></blockquote><p>å°† lib.rs ä¸­çš„ä»£ç æ›¿æ¢ä¸ºï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-db/src/lib.rs data-lang=db/src/lib.rs><span style=display:flex><span><span style=color:#66d9ef>use</span> sqlx::{postgres::PgPoolOptions, Error, PgPool};
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> std::time::Duration;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[derive(Clone)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>DbState</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pub</span> pool: <span style=color:#a6e22e>PgPool</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>connc_db</span>() -&gt; Result<span style=color:#f92672>&lt;</span>PgPool, Error<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    PgPoolOptions::new()
</span></span><span style=display:flex><span>    .max_connections(<span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>    .acquire_timeout(Duration::from_secs(<span style=color:#ae81ff>3</span>))
</span></span><span style=display:flex><span>    .connect(<span style=color:#e6db74>&#34;postgres://your_db_username:your_db_password@localhost/your_db_name&#34;</span>)
</span></span><span style=display:flex><span>    .<span style=color:#66d9ef>await</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><p>ğŸ’¡ è®°å¾—ä¿®æ”¹ä»£ç ä¸­çš„<strong>è¿æ¥å­—ç¬¦ä¸²</strong>ä¸ºä½ è‡ªå·±çš„ï¼ï¼ï¼</p></blockquote><p>ç„¶åï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤æ·»åŠ <code>db</code>çš„ä¾èµ–åˆ°<code>server</code>ï¼š</p><blockquote><p>cd crates/server</p><p>cargo add db</p><p>cargo build</p></blockquote><p>ä¸‹é¢è¿™ä¸€è¡Œä¼šè¢«åŠ å…¥åˆ°<code>server/Cargo.toml</code>ä¸­ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-server/Cargo.toml data-lang=server/Cargo.toml><span style=display:flex><span><span style=color:#a6e22e>db</span> = { <span style=color:#a6e22e>version</span> = <span style=color:#e6db74>&#34;0.1.0&#34;</span>, <span style=color:#a6e22e>path</span> = <span style=color:#e6db74>&#34;../db&#34;</span> }
</span></span></code></pre></div><p>æœ€åï¼Œåœ¨ server/src/main.rs ä¸­åŠ å…¥å¦‚ä¸‹ä»£ç ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-server/src/main.rs data-lang=server/src/main.rs><span style=display:flex><span><span style=color:#66d9ef>use</span> db::connc_db;
</span></span><span style=display:flex><span><span style=color:#75715e>#[tokio::main]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ## init DB pool
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> _pool <span style=color:#f92672>=</span> connc_db().<span style=color:#66d9ef>await</span>.expect(<span style=color:#e6db74>&#34;Can&#39;t connect to database&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#75715e>//...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>è¿è¡Œ<code>cargo run</code>å¯åŠ¨æœåŠ¡å™¨ï¼ŒæœåŠ¡æˆåŠŸå¯åŠ¨ä»£è¡¨æ•°æ®åº“è¿æ¥æˆåŠŸã€‚</p><p>ğŸ”” æé†’ï¼šå¯åŠ¨æœåŠ¡å¤±è´¥ä¼šæ‰“å°ä¸‹é¢çš„æŠ¥é”™ä¿¡æ¯ï¼Œè¿™ä¸ªæ—¶å€™ä½ éœ€è¦éœ€è¦æ£€æŸ¥ä½ çš„æ•°æ®åº“è¿æ¥å’Œæ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²</p><blockquote><p>Can&rsquo;t connect to database</p></blockquote><h3 id=6-é…ç½®ç¯å¢ƒå˜é‡>6. é…ç½®ç¯å¢ƒå˜é‡</h3><p>å‰é¢ç›´æ¥ç¡¬ç¼–ç æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²åˆ°äº†ä»£ç ä¸­ï¼Œåœ¨å®é™…å·¥ç¨‹å®è·µä¸­è¿™æ ·åšæ˜¯å¾ˆä¸åˆç†çš„ã€‚æˆ‘ä»¬åº”è¯¥é€šè¿‡ç¯å¢ƒå˜é‡æ¥é…ç½®æ•°æ®åº“çš„è¿æ¥å­—ç¬¦ä¸²ã€‚</p><p>æ‰§è¡Œä¸‹é¢å‘½ä»¤æ·»åŠ ç¯å¢ƒå˜é‡ä¾èµ–åº“ï¼š</p><blockquote><p>cd crates/db</p><p>cargo add dotenvy</p><p>cargo add dotenvy_macro</p><p>cargo build</p></blockquote><p>é¦–å…ˆï¼Œåœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º<code>.env</code>æ–‡ä»¶ï¼Œå°†ä½ çš„è¿æ¥å­—ç¬¦ä¸²è®¾ç½®ä¸ºç¯å¢ƒå˜é‡<code>DATABASE_URL</code>ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-.env data-lang=.env><span style=display:flex><span>DATABASE_URL<span style=color:#f92672>=</span>postgres://your_db_username:your_db_password@localhost/your_db_name
</span></span></code></pre></div><p>ç„¶åï¼Œä¿®æ”¹ lib.rs çš„ä»£ç ä¸ºä¸‹é¢è¿™æ ·ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-db/src/lib.rs data-lang=db/src/lib.rs><span style=display:flex><span><span style=color:#66d9ef>use</span> dotenvy::dotenv;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> sqlx::{postgres::PgPoolOptions, Error, PgPool};
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> std::{env, time::Duration};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[derive(Clone)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>DbState</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pub</span> pool: <span style=color:#a6e22e>PgPool</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>connc_db</span>() -&gt; Result<span style=color:#f92672>&lt;</span>PgPool, Error<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    dotenv().expect(<span style=color:#e6db74>&#34;.env not found!&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> db_connection_str: String <span style=color:#f92672>=</span> env::var(<span style=color:#e6db74>&#34;DATABASE_URL&#34;</span>).expect(<span style=color:#e6db74>&#34;DATABASE_URL must be set&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    PgPoolOptions::new()
</span></span><span style=display:flex><span>        .max_connections(<span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>        .acquire_timeout(Duration::from_secs(<span style=color:#ae81ff>3</span>))
</span></span><span style=display:flex><span>        .connect(<span style=color:#f92672>&amp;</span>db_connection_str)
</span></span><span style=display:flex><span>        .<span style=color:#66d9ef>await</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œ<code>cargo run</code>å¯åŠ¨æœåŠ¡å™¨ï¼ŒæœåŠ¡æˆåŠŸå¯åŠ¨ä»£è¡¨æ•°æ®åº“è¿æ¥æˆåŠŸã€‚</p><h3 id=7-å®ç°æ•°æ®åº“æŸ¥è¯¢>7. å®ç°æ•°æ®åº“æŸ¥è¯¢</h3><p>åœ¨ db/src ä¸­æ–°å»ºæ–‡ä»¶<code>user.rs</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-db/src/user.rs data-lang=db/src/user.rs><span style=display:flex><span><span style=color:#66d9ef>use</span> serde::{Deserialize, Serialize};
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> sqlx::PgPool;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[derive(sqlx::FromRow, Deserialize, Serialize, Clone)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>User</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pub</span> id: <span style=color:#66d9ef>i32</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pub</span> name: String,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pub</span> email: String,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>query_user</span>(pool: <span style=color:#a6e22e>PgPool</span>) -&gt; Option<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    sqlx::query_as::<span style=color:#f92672>&lt;</span>_, User<span style=color:#f92672>&gt;</span>(<span style=color:#e6db74>&#34;SELECT * FROM users&#34;</span>)
</span></span><span style=display:flex><span>        .fetch_optional(<span style=color:#f92672>&amp;</span>pool)
</span></span><span style=display:flex><span>        .<span style=color:#66d9ef>await</span>
</span></span><span style=display:flex><span>        .expect(<span style=color:#e6db74>&#34;Query error!&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>åœ¨ lib.rs ä¸­å…¬å¼€</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-db/src/lib.rs data-lang=db/src/lib.rs><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>mod</span> user;
</span></span></code></pre></div><p>åœ¨ server ä¸­åˆ›å»º <strong>app-state.rs</strong> å®šä¹‰åº”ç”¨çš„çŠ¶æ€</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-server/src/app_state.rs data-lang=server/src/app_state.rs><span style=display:flex><span><span style=color:#66d9ef>use</span> db::DbState;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[derive(Clone)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>AppState</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pub</span> db: <span style=color:#a6e22e>DbState</span>,
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>åœ¨ server çš„ main.rs ä¸­å°†æ•°æ®åº“çŠ¶æ€åŠ å…¥appçŠ¶æ€ä¸­ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-server/src/main.rs data-lang=server/src/main.rs><span style=display:flex><span><span style=color:#66d9ef>use</span> app_state::AppState;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> axum::{routing::get, Router};
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> db::{connc_db, DbState};
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> handlers::user::get_user;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> tokio::net::TcpListener;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>mod</span> app_state;
</span></span><span style=display:flex><span><span style=color:#66d9ef>mod</span> handlers;
</span></span><span style=display:flex><span><span style=color:#66d9ef>mod</span> models;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[tokio::main]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ## init DB pool
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> pool <span style=color:#f92672>=</span> connc_db().<span style=color:#66d9ef>await</span>.expect(<span style=color:#e6db74>&#34;Can&#39;t connect to database&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ## init app state
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> state: <span style=color:#a6e22e>AppState</span> <span style=color:#f92672>=</span> AppState {
</span></span><span style=display:flex><span>        db: <span style=color:#a6e22e>DbState</span> { pool: <span style=color:#a6e22e>pool</span> },
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> user_router <span style=color:#f92672>=</span> Router::new().route(<span style=color:#e6db74>&#34;/&#34;</span>, get(get_user));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ## build application
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> app <span style=color:#f92672>=</span> Router::new().nest(<span style=color:#e6db74>&#34;/user&#34;</span>, user_router).with_state(state);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ## run app with hyper, listening globally on port 3000
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> listener <span style=color:#f92672>=</span> TcpListener::bind(<span style=color:#e6db74>&#34;0.0.0.0:3000&#34;</span>).<span style=color:#66d9ef>await</span>.unwrap();
</span></span><span style=display:flex><span>    axum::serve(listener, app).<span style=color:#66d9ef>await</span>.unwrap();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>åœ¨ server çš„ handlers/user.rs çš„æ·»åŠ å¯¹ db å‡½æ•° query_user çš„è°ƒç”¨</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-server/src/handlers/user.rs data-lang=server/src/handlers/user.rs><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#66d9ef>crate</span>::{app_state::AppState, models::user::User};
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> axum::{extract::State, http::StatusCode, Json};
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> db::user::{query_user, UserEntity};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[axum_macros::debug_handler]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>get_user</span>(State(state): <span style=color:#a6e22e>State</span><span style=color:#f92672>&lt;</span>AppState<span style=color:#f92672>&gt;</span>) -&gt; Result<span style=color:#f92672>&lt;</span>Json<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span>, StatusCode<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> acc: Option<span style=color:#f92672>&lt;</span>UserEntity<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> query_user(state.db.pool).<span style=color:#66d9ef>await</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> Some(acc) <span style=color:#f92672>=</span> acc {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Ok(Json(User {
</span></span><span style=display:flex><span>            name: <span style=color:#a6e22e>acc</span>.name,
</span></span><span style=display:flex><span>            email: <span style=color:#a6e22e>acc</span>.email,
</span></span><span style=display:flex><span>        }));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Err(StatusCode::<span style=color:#66d9ef>INTERNAL_SERVER_ERROR</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿è¡Œ<code>cargo run</code>å¯åŠ¨æœåŠ¡å™¨ï¼Œåœ¨æµè§ˆå™¨è¾“å…¥<code>localhost:3000/user</code>å°±å¯ä»¥æŸ¥çœ‹æŸ¥è¯¢ç»“æœã€‚</p><h3 id=8-é”™è¯¯å¤„ç†è§„åˆ’ä¸­>8. é”™è¯¯å¤„ç†ï¼ˆè§„åˆ’ä¸­&mldr;ï¼‰</h3><h3 id=9-æ—¥å¿—è®°å½•è§„åˆ’ä¸­>9. æ—¥å¿—è®°å½•ï¼ˆè§„åˆ’ä¸­&mldr;ï¼‰</h3><h3 id=10-webé¡µé¢>10. Webé¡µé¢</h3><p>åœ¨ç°åœ¨çš„å‰ç«¯ç”Ÿæ€ä¸‹ï¼ŒæœåŠ¡å™¨çš„æ¨¡æ¿é¡µé¢å°±æ‹¿æ¥ææé¦–é¡µã€åšå®¢ã€æ–‡æ¡£å°±å¥½äº†ã€‚ç”¨æ¥åšwebåº”ç”¨è¿˜æ˜¯è¦å·®å¾ˆå¤šï¼Œæ‰€ä»¥è¿™ä¸€å—å¯ä»¥ç›´æ¥ä½¿ç”¨çº¯å‰ç«¯é¡¹ç›®ä¸åç«¯åˆ†ç¦»éƒ¨ç½²ï¼Œä¹Ÿå¯ä»¥è‡ªå·±è¯•è¯•ææœåŠ¡ç«¯æ¸²æŸ“ã€‚ä¸åœ¨è¿™é‡Œåšæ¨¡æ¿åŒ–htmlçš„ä»‹ç»äº†ã€‚</p><h3 id=11-å¼€å‘é…ç½®è§„åˆ’ä¸­>11. å¼€å‘é…ç½®ï¼ˆè§„åˆ’ä¸­&mldr;ï¼‰</h3></section></article></div><div x-data=tocHighlighter() @scroll.window=debouncedScroll class="hidden lg:flex lg:flex-col lg:items-end"></div></div><footer class="flex justify-between items-center gap-2 px-4 py-12"><div><p>Â© 2025 è‹¥çƒŸé˜</p><p class=text-sm>ğŸŒ±
<span class=text-base-content/60>Powered by <a class=hover:underline href=https://gohugo.io/ target=_blank>Hugo</a> with theme
<a class=hover:underline href=https://github.com/g1eny0ung/hugo-theme-dream target=_blank>Dream</a>.</span></p></div><div x-data="{ icons: [
    { name: 'sunny', status: 'n' },
    { name: 'moon', status: 'y' },
    { name: 'desktop', status: 'auto' }
  ] }" class="flex items-center gap-2 h-[32px] px-2 bg-base-100 border border-base-content/30 rounded-full"><template x-for="icon in icons"><div role=button tabindex=0 :aria-label="'Select ' + icon.name + ' mode'" class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary" :class="$store.darkMode.icon() === icon.name && 'bg-primary'" @click=$store.darkMode.toggle(icon.status)><ion-icon :name="`${icon.name}-outline`" class=group-hover:text-primary-content :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"></ion-icon></div></template></div></footer></div></div><div class=back><div class=container><div class="dream-grid dream-grid-about"><div class="w-full md:w-1/2 lg:w-1/3 xl:w-1/4 p-4 dream-column"><article class="card bg-base-100 hover:bg-base-content/10 shadow-xl dark:border dark:border-base-content/30"><div class=card-body><div class=card-title>Me</div><div class="prose dark:prose-invert"><p>It&rsquo;s me, It&rsquo;s all.</p></div></div></article></div></div><footer class="flex justify-between items-center gap-2 px-4 py-12"><div><p>Â© 2025 è‹¥çƒŸé˜</p><p class=text-sm>ğŸŒ±
<span class=text-base-content/60>Powered by <a class=hover:underline href=https://gohugo.io/ target=_blank>Hugo</a> with theme
<a class=hover:underline href=https://github.com/g1eny0ung/hugo-theme-dream target=_blank>Dream</a>.</span></p></div><div x-data="{ icons: [
    { name: 'sunny', status: 'n' },
    { name: 'moon', status: 'y' },
    { name: 'desktop', status: 'auto' }
  ] }" class="flex items-center gap-2 h-[32px] px-2 bg-base-100 border border-base-content/30 rounded-full"><template x-for="icon in icons"><div role=button tabindex=0 :aria-label="'Select ' + icon.name + ' mode'" class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary" :class="$store.darkMode.icon() === icon.name && 'bg-primary'" @click=$store.darkMode.toggle(icon.status)><ion-icon :name="`${icon.name}-outline`" class=group-hover:text-primary-content :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"></ion-icon></div></template></div></footer></div></div></div></div><script>window.lightTheme="emerald",window.darkTheme="forest"</script><script src=https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin=anonymous></script><script src=/blog/js/grid.min.js></script><script src=/blog/js/main.min.js></script><script src=/blog/js/toc.min.js></script><script type=module src=https://cdn.jsdelivr.net/npm/ionicons@7.4.0/dist/ionicons/ionicons.esm.js integrity="sha256-/IFmi82bIhdYWctu0UddSlJqpnzWm7Vh2C4CM32wF/k=" crossorigin=anonymous></script><script nomodule src=https://cdn.jsdelivr.net/npm/ionicons@7.4.0/dist/ionicons/ionicons.js integrity="sha256-mr7eJMX3VC3F7G32mk4oWp1C6a2tlMYxUdptfT7uKI8=" crossorigin=anonymous></script></body></html>